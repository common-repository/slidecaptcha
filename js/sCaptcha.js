jQuery(document).on('ready', function(){ jQuery('.touchsurface + .form-submit #submit').prop('disabled', true); var touchsurface = jQuery('.touchsurface.not-finished'), slide = jQuery('.touchsurface .slide'), formParent = touchsurface.closest('form'), startX = 0, startSlideCoord=0, touchsurfaceWidth=touchsurface.outerWidth(), touchsurfaceHeight=touchsurface.outerHeight(), slideWidth = slide.width()+4, zeroLeft = 0, touched = false; touchsurface.on('touchstart mousedown', function(e){ var clientX; if (e.type=='touchstart') clientX = e.originalEvent.touches[0].pageX; else clientX = e.clientX; zeroLeft =touchsurface.offset().left; clientX=clientX-zeroLeft; console.log(clientX+'click'); if (clientX>0 && clientX<50 ) { jQuery(this).addClass('dragging'); touched = true; startSlideCoord=clientX; startX = clientX; return; } }); touchsurface.on('mouseleave', function(e){ touchEnd(); }); touchsurface.on('touchmove mousemove', function(e){ touchsurfaceWidth=touchsurface.width(); slideWidth=slide.width()+4; var clientX; if (e.type=='touchmove') clientX = e.originalEvent.touches[0].pageX; else clientX = e.clientX; clientX=clientX-zeroLeft; if (touched){ if (startX < clientX || startX>clientX) { slide.css('left', clientX); slide.data('left', clientX); if (clientX < 2) { startX = 0; /*   touchsurface.trigger('mouseup');*/ touchEnd(); return; } else if( clientX+slideWidth>touchsurfaceWidth) { startX=touchsurfaceWidth; slide.css('left', touchsurfaceWidth-slideWidth); slide.data('left', touchsurfaceWidth-slideWidth); jQuery('.touchsurface + .form-submit #submit').prop('disabled', false); console.log(formParent.find('#is_bot')); console.log('slide width = '+slideWidth); console.log('surface width = '+touchsurfaceWidth); formParent.find('#is_bot').val('imNotBot'); touchEnd(); touchsurface.addClass('finished'); touchsurface.removeClass('not-finished'); touchsurface.off('mouseup touchend touchmove mousemove touchstart mousedown'); return; } } startX=clientX; console.log(touchsurfaceWidth+ ' width'); } }); touchsurface.on(' mouseup touchend ', function(e){ touchEnd(); }); function touchEnd(){ touched = false; touchsurface.removeClass('dragging'); if (startX<touchsurfaceWidth) var interval = setInterval(function(){ console.log(1); startX = startX - 2; if (startX <= 0) { clearInterval(interval); startX = 0; } slide.css('left', startX); slide.data('left',startX); }, 1); } });